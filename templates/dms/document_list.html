{% extends 'dms/base.html' %}

{% block title %}Dokumente{% endblock %}
{% block page_title %}Dokumente{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Dokumente</h2>
        <a href="{% url 'dms:upload_page' %}" class="btn btn-success">
            <span class="material-icons" style="font-size: 16px;">cloud_upload</span>
            Neu hochladen
        </a>
    </div>
    
    <form method="get" class="filters">
        <input type="text" name="search" class="form-control" style="width: 280px;" placeholder="Suchen..." value="{{ request.GET.search }}">
        <select name="status" class="form-control" style="width: 160px;">
            <option value="">Alle Status</option>
            {% for value, label in status_choices %}
            <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <select name="source" class="form-control" style="width: 160px;">
            <option value="">Alle Quellen</option>
            {% for value, label in source_choices %}
            <option value="{{ value }}" {% if request.GET.source == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn">
            <span class="material-icons" style="font-size: 16px;">search</span>
            Filtern
        </button>
        {% if request.GET.search or request.GET.status or request.GET.source %}
            <a href="{% url 'dms:document_list' %}" class="btn btn-outline">
                <span class="material-icons" style="font-size: 16px;">clear</span>
                Zurücksetzen
            </a>
        {% endif %}
    </form>
    
    {% if documents %}
    <table>
        <thead>
            <tr>
                <th>Titel</th>
                <th>Typ</th>
                <th>Status</th>
                <th>Quelle</th>
                <th>Mitarbeiter</th>
                <th>Größe</th>
                <th>Datum</th>
                <th style="text-align: right;">Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in documents %}
            <tr>
                <td>
                    <div style="font-weight: 500;">{{ doc.title }}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">{{ doc.original_filename }}</div>
                </td>
                <td>{{ doc.document_type.name|default:"-" }}</td>
                <td>
                    <span class="badge badge-{{ doc.status|lower }}">{{ doc.get_status_display }}</span>
                </td>
                <td style="color: var(--text-secondary);">{{ doc.get_source_display }}</td>
                <td>{{ doc.employee.full_name|default:"-" }}</td>
                <td style="color: var(--text-secondary);">{{ doc.file_size_display }}</td>
                <td style="color: var(--text-secondary);">{{ doc.created_at|date:"d.m.Y" }}</td>
                <td style="text-align: right;">
                    <a href="{% url 'dms:document_detail' doc.pk %}" class="btn btn-sm btn-outline">
                        <span class="material-icons" style="font-size: 14px;">visibility</span>
                    </a>
                    <a href="{% url 'dms:document_download' doc.pk %}" class="btn btn-sm">
                        <span class="material-icons" style="font-size: 14px;">download</span>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if documents.has_other_pages %}
    <div class="pagination">
        {% if documents.has_previous %}
            <a href="?page={{ documents.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.source %}&source={{ request.GET.source }}{% endif %}">
                <span class="material-icons" style="font-size: 16px; vertical-align: middle;">chevron_left</span>
                Zurück
            </a>
        {% endif %}
        
        <span class="current">Seite {{ documents.number }} von {{ documents.paginator.num_pages }}</span>
        
        {% if documents.has_next %}
            <a href="?page={{ documents.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.source %}&source={{ request.GET.source }}{% endif %}">
                Weiter
                <span class="material-icons" style="font-size: 16px; vertical-align: middle;">chevron_right</span>
            </a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <div class="empty-state">
        <span class="material-icons">folder_off</span>
        <h3>Keine Dokumente gefunden</h3>
        <p>Es wurden keine Dokumente gefunden, die Ihren Filterkriterien entsprechen.</p>
        <a href="{% url 'dms:upload_page' %}" class="btn" style="margin-top: 16px;">
            <span class="material-icons">cloud_upload</span>
            Dokument hochladen
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
