{% extends 'dms/base.html' %}

{% block title %}Documents{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Documents</h2>
        <a href="{% url 'dms:upload_page' %}" class="btn btn-success">Upload New</a>
    </div>
    
    <form method="get" style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <input type="text" name="search" placeholder="Search..." value="{{ request.GET.search }}" 
               style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; flex: 1; min-width: 200px;">
        <select name="status" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="">All Status</option>
            {% for value, label in status_choices %}
            <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <select name="source" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="">All Sources</option>
            {% for value, label in source_choices %}
            <option value="{{ value }}" {% if request.GET.source == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn">Filter</button>
    </form>
    
    {% if documents %}
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Type</th>
                <th>Status</th>
                <th>Source</th>
                <th>Employee</th>
                <th>Size</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in documents %}
            <tr>
                <td>
                    <strong>{{ doc.title }}</strong>
                    <br><small style="color: #666;">{{ doc.original_filename }}</small>
                </td>
                <td>{{ doc.document_type.name|default:"-" }}</td>
                <td>
                    <span class="badge badge-{{ doc.status|lower }}">{{ doc.get_status_display }}</span>
                </td>
                <td>{{ doc.get_source_display }}</td>
                <td>{{ doc.employee.full_name|default:"-" }}</td>
                <td>
                    {% if doc.file_size < 1024 %}{{ doc.file_size }} B
                    {% elif doc.file_size < 1048576 %}{{ doc.file_size|floatformat:0|divisibleby:1024 }} KB
                    {% else %}{{ doc.file_size|floatformat:1|divisibleby:1048576 }} MB{% endif %}
                </td>
                <td>{{ doc.created_at|date:"M d, Y" }}</td>
                <td>
                    <a href="{% url 'dms:document_detail' doc.pk %}" class="btn" style="padding: 5px 10px; font-size: 12px;">View</a>
                    <a href="{% url 'dms:document_download' doc.pk %}" class="btn btn-success" style="padding: 5px 10px; font-size: 12px;">Download</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if documents.has_other_pages %}
    <div style="margin-top: 20px; text-align: center;">
        {% if documents.has_previous %}
        <a href="?page={{ documents.previous_page_number }}" class="btn">Previous</a>
        {% endif %}
        <span style="margin: 0 15px;">Page {{ documents.number }} of {{ documents.paginator.num_pages }}</span>
        {% if documents.has_next %}
        <a href="?page={{ documents.next_page_number }}" class="btn">Next</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <p style="color: #666; text-align: center; padding: 40px;">No documents found.</p>
    {% endif %}
</div>
{% endblock %}
