{% extends 'dms/base.html' %}

{% block title %}{{ document.title }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start;">
        <div>
            <h2>{{ document.title }}</h2>
            <p style="color: #666;">{{ document.original_filename }}</p>
        </div>
        <div>
            <a href="{% url 'dms:document_edit' document.pk %}" class="btn btn-primary">Bearbeiten</a>
            <a href="{% url 'dms:document_download' document.pk %}" class="btn btn-success">Herunterladen</a>
            <a href="{% url 'dms:document_list' %}" class="btn">Zurück zur Liste</a>
        </div>
    </div>
</div>

{% if document.mime_type == 'application/pdf' %}
<div class="card" style="margin-bottom: 20px;">
    <h2>Dokumentvorschau</h2>
    <iframe src="{% url 'dms:document_view' document.pk %}" style="width: 100%; height: 800px; border: 1px solid #ddd; border-radius: 4px;"></iframe>
</div>
{% elif document.mime_type|slice:":6" == 'image/' %}
<div class="card" style="margin-bottom: 20px;">
    <h2>Dokumentvorschau</h2>
    <img src="{% url 'dms:document_view' document.pk %}" style="max-width: 100%; height: auto; border-radius: 4px;" alt="{{ document.title }}">
</div>
{% endif %}

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <div class="card">
        <h2>Dokumentinformationen</h2>
        <table>
            <tr><th style="width: 140px;">ID</th><td>{{ document.id }}</td></tr>
            <tr><th>Status</th><td><span class="badge badge-{{ document.status|lower }}">{{ document.get_status_display }}</span></td></tr>
            <tr><th>Quelle</th><td>{{ document.get_source_display }}</td></tr>
            <tr><th>Typ</th><td>{{ document.document_type.name|default:"Nicht zugewiesen" }}</td></tr>
            <tr><th>MIME-Typ</th><td>{{ document.mime_type }}</td></tr>
            <tr><th>Größe</th><td>{{ document.file_size_display }}</td></tr>
        </table>
    </div>
    
    <div class="card">
        <h2>Zuweisung</h2>
        <table>
            <tr><th style="width: 140px;">Mitarbeiter</th><td>{{ document.employee.full_name|default:"Nicht zugewiesen" }}</td></tr>
            <tr><th>Besitzer</th><td>{{ document.owner.username|default:"System" }}</td></tr>
            <tr><th>Erstellt</th><td>{{ document.created_at|date:"d.m.Y H:i" }}</td></tr>
            <tr><th>Aktualisiert</th><td>{{ document.updated_at|date:"d.m.Y H:i" }}</td></tr>
            {% if document.archived_at %}
            <tr><th>Archiviert</th><td>{{ document.archived_at|date:"d.m.Y H:i" }}</td></tr>
            {% endif %}
        </table>
    </div>
</div>

{% if document.notes %}
<div class="card">
    <h2>Notizen</h2>
    <p>{{ document.notes }}</p>
</div>
{% endif %}

{% if document.metadata %}
<div class="card">
    <h2>Metadaten</h2>
    <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;">{{ document.metadata|pprint }}</pre>
</div>
{% endif %}

{% if document.tasks.exists %}
<div class="card">
    <h2>Zugehörige Aufgaben</h2>
    <table>
        <thead>
            <tr><th>Titel</th><th>Status</th><th>Priorität</th><th>Zugewiesen an</th></tr>
        </thead>
        <tbody>
            {% for task in document.tasks.all %}
            <tr>
                <td>{{ task.title }}</td>
                <td>{{ task.get_status_display }}</td>
                <td>{{ task.get_priority_display }}</td>
                <td>{{ task.assigned_to.username|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
