{% extends 'dms/base.html' %}

{% block title %}{{ document.title }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start;">
        <div>
            <h2>{{ document.title }}</h2>
            <p style="color: #666;">{{ document.original_filename }}</p>
        </div>
        <div>
            <a href="{% url 'dms:document_download' document.pk %}" class="btn btn-success">Download</a>
            <a href="{% url 'dms:document_list' %}" class="btn">Back to List</a>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <div class="card">
        <h2>Document Info</h2>
        <table>
            <tr><th style="width: 140px;">ID</th><td>{{ document.id }}</td></tr>
            <tr><th>Status</th><td><span class="badge badge-{{ document.status|lower }}">{{ document.get_status_display }}</span></td></tr>
            <tr><th>Source</th><td>{{ document.get_source_display }}</td></tr>
            <tr><th>Type</th><td>{{ document.document_type.name|default:"Not assigned" }}</td></tr>
            <tr><th>MIME Type</th><td>{{ document.mime_type }}</td></tr>
            <tr><th>Size</th><td>
                {% if document.file_size < 1024 %}{{ document.file_size }} bytes
                {% elif document.file_size < 1048576 %}{{ document.file_size|floatformat:1|divisibleby:1024 }} KB
                {% else %}{{ document.file_size|floatformat:2|divisibleby:1048576 }} MB{% endif %}
            </td></tr>
        </table>
    </div>
    
    <div class="card">
        <h2>Assignment</h2>
        <table>
            <tr><th style="width: 140px;">Employee</th><td>{{ document.employee.full_name|default:"Not assigned" }}</td></tr>
            <tr><th>Owner</th><td>{{ document.owner.username|default:"System" }}</td></tr>
            <tr><th>Created</th><td>{{ document.created_at|date:"M d, Y H:i" }}</td></tr>
            <tr><th>Updated</th><td>{{ document.updated_at|date:"M d, Y H:i" }}</td></tr>
            {% if document.archived_at %}
            <tr><th>Archived</th><td>{{ document.archived_at|date:"M d, Y H:i" }}</td></tr>
            {% endif %}
        </table>
    </div>
</div>

{% if document.notes %}
<div class="card">
    <h2>Notes</h2>
    <p>{{ document.notes }}</p>
</div>
{% endif %}

{% if document.metadata %}
<div class="card">
    <h2>Metadata</h2>
    <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;">{{ document.metadata|pprint }}</pre>
</div>
{% endif %}

{% if document.tasks.exists %}
<div class="card">
    <h2>Related Tasks</h2>
    <table>
        <thead>
            <tr><th>Title</th><th>Status</th><th>Priority</th><th>Assigned To</th></tr>
        </thead>
        <tbody>
            {% for task in document.tasks.all %}
            <tr>
                <td>{{ task.title }}</td>
                <td>{{ task.get_status_display }}</td>
                <td>{{ task.get_priority_display }}</td>
                <td>{{ task.assigned_to.username|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
